<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI íšŒí™” í•™ìŠµ ì„¼í„°</title>
    <style>
        /* ëª¨ë°”ì¼ì—ì„œ ë²„íŠ¼ì´ í¼ì§í•˜ê²Œ ë³´ì´ë„ë¡ ë””ìì¸ */
        body { font-family: -apple-system, sans-serif; text-align: center; padding: 20px; background: #fdfcf0; margin: 0; }
        .container { background: white; max-width: 400px; margin: 20px auto; padding: 25px; border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .screen { display: none; } 
        .active { display: block; }
        
        button { padding: 18px; font-size: 18px; font-weight: bold; cursor: pointer; border-radius: 15px; border: none; margin: 10px 0; width: 100%; transition: 0.2s; }
        .lvl-btn { background: #2ECC71; color: white; box-shadow: 0 4px #27ae60; }
        .lvl-btn:active { transform: translateY(3px); box-shadow: none; }
        
        .mic-btn { background: #E74C3C; color: white; font-size: 20px; height: 80px; margin-top: 20px; }
        .mic-btn.recording { background: #c0392b; animation: pulse 1.2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
        
        #recognizedText { margin-top: 25px; font-size: 16px; color: #666; min-height: 50px; padding: 10px; background: #f9f9f9; border-radius: 10px; border: 1px dashed #ccc; }
        #resultMsg { margin-top: 20px; font-weight: bold; font-size: 22px; }
        .next-btn { background: #3498db; color: white; display: none; } /* ì •ë‹µì¼ ë•Œë§Œ ë³´ì„ */
    </style>
</head>
<body>

    <div id="level-screen" class="screen active">
        <h2 style="margin-top:40px;">íšŒí™” ë ˆë²¨ ì„ íƒ</h2>
        <p style="color:#888;">ì—°ìŠµí•  ë‹¨ê³„ë¥¼ ê³¨ë¼ì£¼ì„¸ìš”.</p>
        <div style="max-width:300px; margin: 0 auto;">
            <button class="lvl-btn" onclick="startApp(1)">Level 1 ì‹œì‘</button>
            <button class="lvl-btn" onclick="startApp(2)">Level 2 ì‹œì‘</button>
        </div>
    </div>

    <div id="quiz-screen" class="screen">
        <div class="container">
            <div id="info" style="font-size:14px; color:#aaa;"></div>
            <div id="koreanQ" style="font-size:26px; font-weight:bold; margin:20px 0; color:#2c3e50; line-height:1.4;"></div>
            
            <div id="recognizedText">ì•„ë˜ ë²„íŠ¼ì„ ëˆ„ë¥´ê³  ë§ì”€í•˜ì„¸ìš”.</div>
            
            <button id="micBtn" class="mic-btn" onclick="toggleListening()">ğŸ¤ ë§í•˜ê¸° ì‹œì‘</button>
            <button id="nextBtn" class="next-btn" onclick="nextSentence()">ë‹¤ìŒ ë¬¸ì¥ìœ¼ë¡œ ğŸ‘‰</button>
            
            <div id="resultMsg"></div>
        </div>
        <button onclick="location.href='index.html'" style="background:none; color:#aaa; font-size:14px; text-decoration:underline;">ê·¸ë§Œí•˜ê¸°</button>
    </div>

    <script>
        let sentences = [];
        let currentIdx = 0;
        let isListening = false;
        
        // ì•„ì´í°/ì•ˆë“œë¡œì´ë“œ í†µí•© ìŒì„± ì¸ì‹ ì—”ì§„ ì„¤ì •
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì•„ì´í°ì€ Safari, ì•ˆë“œë¡œì´ë“œëŠ” Chromeì„ ì´ìš©í•´ ì£¼ì„¸ìš”.");
        }
        const recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        recognition.interimResults = false;

        function startApp(level) {
            document.getElementById('level-screen').classList.remove('active');
            document.getElementById('quiz-screen').classList.add('active');

            fetch(`speak${level}.json`)
                .then(res => res.json())
                .then(data => {
                    sentences = data;
                    show();
                })
                .catch(() => alert("ë°ì´í„° íŒŒì¼(speak" + level + ".json)ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!"));
        }

        function show() {
            if (currentIdx < sentences.length) {
                const item = sentences[currentIdx];
                document.getElementById('koreanQ').innerText = item.Korean;
                document.getElementById('info').innerText = `ë¬¸ì¥ ${currentIdx + 1} / ${sentences.length}`;
                document.getElementById('recognizedText').innerText = "ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...";
                document.getElementById('resultMsg').innerText = "";
                document.getElementById('micBtn').style.display = "block";
                document.getElementById('nextBtn').style.display = "none";
            } else {
                alert("ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ì—°ìŠµì„ ë§ˆì³¤ìŠµë‹ˆë‹¤.");
                location.href = 'index.html';
            }
        }

        function toggleListening() {
            try {
                recognition.start();
            } catch (e) {
                recognition.stop();
            }
        }

        recognition.onstart = () => {
            isListening = true;
            const btn = document.getElementById('micBtn');
            btn.innerText = "ğŸ§ ë“£ê³  ìˆì–´ìš”...";
            btn.classList.add('recording');
        };

        recognition.onresult = (event) => {
            const speechResult = event.results[0][0].transcript.toLowerCase().replace(/[.?!,]/g, "").trim();
            document.getElementById('recognizedText').innerText = `ë‚´ ëª©ì†Œë¦¬: "${speechResult}"`;
            checkAnswer(speechResult);
        };

        recognition.onend = () => {
            isListening = false;
            const btn = document.getElementById('micBtn');
            btn.innerText = "ğŸ¤ ë‹¤ì‹œ ë§í•˜ê¸°";
            btn.classList.remove('recording');
        };

        function checkAnswer(speech) {
            const correct = sentences[currentIdx].English.toLowerCase().replace(/[.?!,]/g, "").trim();
            const resultArea = document.getElementById('resultMsg');

            if(speech === correct) {
                resultArea.innerText = "â­• Perfect! ì •í™•í•´ìš”!";
                resultArea.style.color = "#2ECC71";
                document.getElementById('micBtn').style.display = "none";
                document.getElementById('nextBtn').style.display = "block";
            } else {
                resultArea.innerText = `âŒ ì¡°ê¸ˆ ë‹¬ë¼ìš”! ì •ë‹µ: "${correct}"`;
                resultArea.style.color = "#E74C3C";
            }
        }

        function nextSentence() {
            currentIdx++;
            show();
        }

        recognition.onerror = (event) => {
            if(event.error === 'not-allowed') alert("ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ ì£¼ì„¸ìš”!");
            isListening = false;
            document.getElementById('micBtn').innerText = "ğŸ¤ ë§í•˜ê¸° ì‹œì‘";
            document.getElementById('micBtn').classList.remove('recording');
        };
    </script>
</body>
</html>