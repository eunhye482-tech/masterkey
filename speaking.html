<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI íšŒí™” í•™ìŠµ</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        body { 
            font-family: -apple-system, sans-serif; text-align: center; padding: 20px; margin: 0;
            /* ë°°ê²½ ì´ë¯¸ì§€: 2.png ì ìš© */
            background-image: url('2.png'); 
            background-size: cover; background-position: center; background-attachment: fixed;
        }
        .container { 
            background: rgba(255, 255, 255, 0.9); max-width: 450px; margin: 10px auto; padding: 20px; 
            border-radius: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); 
        }
        .screen { display: none; } .active { display: block; }
        button { padding: 15px; font-size: 17px; font-weight: bold; cursor: pointer; border-radius: 15px; border: none; margin: 10px 0; width: 100%; }
        .lvl-btn { background: #2ECC71; color: white; }
        .mic-btn { background: #E74C3C; color: white; font-size: 20px; height: 70px; }
        .next-btn { background: #3498db; color: white; display: none; }
        #report-card { background: white; padding: 30px; border: 5px solid #4A90E2; border-radius: 20px; }
        .score-big { font-size: 50px; color: #E74C3C; font-weight: bold; margin: 20px 0; }
    </style>
</head>
<body>
    <div id="level-screen" class="screen active">
        <div class="container">
            <h2 style="margin-top:20px;">AI SPEAKING</h2>
            <button class="lvl-btn" onclick="startApp(1)">Level 1 ì—°ìŠµí•˜ê¸°</button>
            <button class="lvl-btn" onclick="startApp(2)">Level 2 ì—°ìŠµí•˜ê¸°</button>
        </div>
    </div>
    <div id="study-screen" class="screen">
        <div class="container">
            <h3>ë¯¸ë¦¬ë³´ê¸° í•™ìŠµ</h3>
            <div id="sentence-list"></div>
            <button onclick="startQuiz()" style="background:#E74C3C; color:white; margin-top:20px;">ì‹œí—˜ ì‹œì‘ ğŸ‘‰</button>
        </div>
    </div>
    <div id="quiz-screen" class="screen">
        <div class="container">
            <div id="info"></div>
            <div id="koreanQ" style="font-size:24px; font-weight:bold; margin:15px 0;"></div>
            <div id="recognizedText">ë§ì”€í•˜ì„¸ìš”...</div>
            <button id="micBtn" class="mic-btn" onclick="toggleListening()">ğŸ¤ ë§í•˜ê¸°</button>
            <button id="nextBtn" class="next-btn" onclick="nextSentence()">ë‹¤ìŒìœ¼ë¡œ ğŸ‘‰</button>
            <div id="resultMsg"></div>
        </div>
    </div>
    <div id="report-screen" class="screen">
        <div id="report-area" style="padding:10px; background:#f0f0f0;">
            <div id="report-card">
                <h2>SPEAKING REPORT</h2>
                <div class="score-big" id="final-score">0ì </div>
                <div id="score-summary"></div>
                <h3 style="color:#4A90E2;">Keep it up! ğŸ‘</h3>
            </div>
        </div>
        <div class="container">
            <button onclick="saveAsImg()" style="background:#2ECC71; color:white;">ğŸ“¸ ì„±ì í‘œ ì´ë¯¸ì§€ ì €ì¥</button>
            <button onclick="location.href='index.html'" style="background:#eee;">ë©”ì¸ìœ¼ë¡œ</button>
        </div>
    </div>
    <script>
        let sentences = []; let currentIdx = 0; let score = 0;
        function speak(text) { const uttr = new SpeechSynthesisUtterance(text); uttr.lang = 'en-US'; window.speechSynthesis.speak(uttr); }
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const recognition = SpeechRecognition ? new SpeechRecognition() : null;
        if(recognition) { recognition.lang = 'en-US'; recognition.interimResults = false; }
        function startApp(level) { fetch(`speak${level}.json`).then(res => res.json()).then(data => { sentences = data; showStudyList(); }); }
        function showStudyList() {
            document.getElementById('level-screen').classList.remove('active');
            document.getElementById('study-screen').classList.add('active');
            const listDiv = document.getElementById('sentence-list'); listDiv.innerHTML = "";
            sentences.forEach(item => {
                listDiv.innerHTML += `<div style="text-align:left; border-bottom:1px solid #eee; padding:10px;">
                    <strong>${item.Korean}</strong><br><small>${item.English}</small>
                    <button style="width:30px; height:30px; float:right;" onclick="speak('${item.English.replace(/'/g, "\\'")}')">ğŸ”Š</button>
                </div>`;
            });
        }
        function startQuiz() { document.getElementById('study-screen').classList.remove('active'); document.getElementById('quiz-screen').classList.add('active'); currentIdx = 0; score = 0; showQuiz(); }
        function showQuiz() {
            if (currentIdx < sentences.length) {
                document.getElementById('koreanQ').innerText = sentences[currentIdx].Korean;
                document.getElementById('info').innerText = `${currentIdx + 1} / ${sentences.length}`;
                document.getElementById('resultMsg').innerText = "";
                document.getElementById('micBtn').style.display = "block"; document.getElementById('nextBtn').style.display = "none";
            } else { showReport(); }
        }
        function toggleListening() { try { recognition.start(); } catch (e) { recognition.stop(); } }
        if(recognition) {
            recognition.onresult = (event) => {
                const speechResult = event.results[0][0].transcript.toLowerCase().replace(/[.?!,]/g, "").trim();
                const correct = sentences[currentIdx].English.toLowerCase().replace(/[.?!,]/g, "").trim();
                if(speechResult === correct || correct.includes(speechResult)) {
                    document.getElementById('resultMsg').innerText = "â­• Good!"; score++;
                    document.getElementById('micBtn').style.display = "none"; document.getElementById('nextBtn').style.display = "block"; speak(correct);
                } else { document.getElementById('resultMsg').innerText = "âŒ Try Again!"; }
            };
        }
        function nextSentence() { currentIdx++; showQuiz(); }
        function showReport() {
            document.getElementById('quiz-screen').classList.remove('active'); document.getElementById('report-screen').classList.add('active');
            const finalPercent = Math.round((score / sentences.length) * 100);
            document.getElementById('final-score').innerText = finalPercent + "ì ";
            document.getElementById('score-summary').innerText = `ì´ ${sentences.length}ë¬¸ì¥ ì¤‘ ${score}ë¬¸ì¥ ì„±ê³µ!`;
        }
        function saveAsImg() {
            const area = document.getElementById('report-area');
            html2canvas(area).then(canvas => {
                const link = document.createElement('a'); link.download = 'report.png';
                link.href = canvas.toDataURL("image/png"); link.click();
            });
        }
    </script>
</body>
</html>