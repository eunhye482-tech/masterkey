<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë ˆë²¨ 1 ë‹¨ì–´ ë§ˆìŠ¤í„°</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #4A90E2; --success: #2ECC71; --error: #E74C3C; --bg: #f5f7f9; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; background: var(--bg); color: #333; }
        .container { max-width: 500px; margin: 0 auto; padding: 20px; box-sizing: border-box; }
        .screen { display: none; }
        .screen.active { display: block; }
        
        /* ëª©ë¡ í™”ë©´ */
        .list-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        .list-btn { padding: 15px 5px; background: white; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; text-align: center; font-weight: bold; }
        
        /* í•™ìŠµ í™”ë©´ */
        .word-item { background: white; padding: 15px; margin-bottom: 10px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn-group button { flex: 1; padding: 15px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .btn-meaning { background: var(--primary); }
        .btn-spell { background: var(--success); }

        /* í…ŒìŠ¤íŠ¸ í™”ë©´ */
        .test-box { background: white; padding: 30px; border-radius: 15px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .test-question { font-size: 2.2rem; margin-bottom: 20px; font-weight: bold; color: var(--primary); }
        input { width: 90%; padding: 15px; font-size: 1.2rem; border: 2px solid #ddd; border-radius: 10px; outline: none; text-align: center; }
        input:focus { border-color: var(--primary); }
        .feedback { margin-top: 20px; font-weight: bold; min-height: 30px; font-size: 1.1rem; }

        /* ì„±ì í‘œ ìŠ¤íƒ€ì¼ */
        #report-card { background: white; padding: 25px; border-radius: 20px; border: 4px solid var(--primary); text-align: center; margin-top: 10px; }
        .report-list { text-align: left; margin: 20px 0; border-top: 2px solid #eee; padding-top: 15px; font-size: 0.95rem; }
        .report-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dotted #eee; }
        .ox-o { color: var(--success); font-weight: bold; }
        .ox-x { color: var(--error); font-weight: bold; }
        .correct-ans { font-size: 0.85rem; color: #888; margin-left: 5px; text-decoration: underline; }
        .capture-hint { font-size: 0.85rem; color: #888; margin-top: 15px; text-align: center; }
    </style>
</head>
<body>
<div class="container">
    
    <div id="screen-list" class="screen active">
        <h2 style="text-align: center;">ğŸ“š ë ˆë²¨ 1 ëª©ë¡ (1-100)</h2>
        <p style="text-align: center; color: #666; font-size: 0.9rem;">í•™ìŠµí•  ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
        <div class="list-grid" id="list-container"></div>
    </div>

    <div id="screen-study" class="screen">
        <h3 id="study-title" style="text-align: center;"></h3>
        <div id="study-container"></div>
        <div class="btn-group">
            <button class="btn-meaning" onclick="startTest('meaning')">ëœ» ê³µë¶€ ì‹œì‘</button>
            <button class="btn-spell" onclick="startTest('spell')">ì² ì ê³µë¶€ ì‹œì‘</button>
        </div>
        <button onclick="showList()" style="width:100%; margin-top:15px; background:none; border:none; color:#888; cursor:pointer;">â—€ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="screen-test" class="screen">
        <div class="test-box">
            <div id="test-progress" style="color:#888; margin-bottom:10px;">1 / 10</div>
            <div class="test-question" id="test-q"></div>
            <input type="text" id="test-input" placeholder="ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off">
            <div class="feedback" id="test-feedback"></div>
        </div>
    </div>

    <div id="screen-result" class="screen">
        <div id="report-card">
            <h1 style="color:var(--primary); margin: 0;">ì„±ì í‘œ</h1>
            <p id="report-date" style="color:#888; margin: 5px 0;"></p>
            <div style="font-size: 3.5rem; margin: 15px 0; font-weight: bold;" id="report-score"></div>
            <p id="report-level" style="font-weight: bold; color: #555;"></p>
            
            <div id="report-detail-list" class="report-list">
                </div>

            <button onclick="saveAsImage()" style="background:var(--primary); color:white; border:none; padding:12px 25px; border-radius:8px; font-weight:bold; cursor:pointer; width: 100%;">ì´ë¯¸ì§€ ì €ì¥í•˜ê¸° (PNG)</button>
        </div>
        <p class="capture-hint">í´ë¦­í•˜ë©´ ì„±ì í‘œê°€ ì‚¬ì§„ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤.</p>
        <button onclick="showList()" style="width:100%; margin-top:15px; padding:15px; background:#ddd; border:none; border-radius:8px; cursor:pointer; font-weight:bold;">ë‹¤ë¥¸ ëª©ë¡ ë„ì „í•˜ê¸°</button>
    </div>

</div>

<script>
let allWords = [];
let currentListWords = [];
let currentMode = ''; 
let currentIndex = 0;
let score = 0;
let testResults = []; 

// 1. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (ê°•ì‚¬ë‹˜ì˜ words_lv1.json íŒŒì¼ê³¼ ì—°ê²°)
fetch('words_lv1.json')
    .then(res => res.json())
    .then(data => {
        allWords = data;
        renderListMenu();
    });

// 2. ëª©ë¡ ë©”ë‰´ ìƒì„± (1~100ë²ˆ ë²„íŠ¼)
function renderListMenu() {
    const container = document.getElementById('list-container');
    for (let i = 1; i <= 100; i++) {
        const btn = document.createElement('div');
        btn.className = 'list-btn';
        btn.innerText = i;
        btn.onclick = () => showStudy(i);
        container.appendChild(btn);
    }
}

// 3. ë‹¨ì–´ í•™ìŠµ í™”ë©´ (10ê°œ ë…¸ì¶œ)
function showStudy(listNum) {
    currentIndex = 0;
    score = 0;
    const startIdx = (listNum - 1) * 10;
    currentListWords = allWords.slice(startIdx, startIdx + 10);
    
    document.getElementById('study-title').innerText = `ëª©ë¡ ${listNum} (10ë‹¨ì–´)`;
    const container = document.getElementById('study-container');
    container.innerHTML = '';
    
    currentListWords.forEach(w => {
        const item = document.createElement('div');
        item.className = 'word-item';
        // ê°•ì‚¬ë‹˜ ë°ì´í„°ì˜ í‚¤ ê°’ì¸ Word, Meaning ì‚¬ìš©
        item.innerHTML = `<span><strong>${w.Word}</strong></span> <span>${w.Meaning} ğŸ”Š</span>`;
        item.onclick = () => speak(w.Word);
        container.appendChild(item);
    });
    
    switchScreen('screen-study');
}

// 4. ìŒì„± ì¶œë ¥
function speak(text) {
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'en-US';
    window.speechSynthesis.speak(utterance);
}

// 5. í…ŒìŠ¤íŠ¸ ì‹œì‘ ì„¤ì •
function startTest(mode) {
    currentMode = mode;
    currentIndex = 0;
    score = 0;
    testResults = []; 
    switchScreen('screen-test');
    nextQuestion();
}

// 6. ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
function nextQuestion() {
    if (currentIndex >= 10) {
        showResult();
        return;
    }
    
    const w = currentListWords[currentIndex];
    const qDiv = document.getElementById('test-q');
    const input = document.getElementById('test-input');
    const progress = document.getElementById('test-progress');
    const feedback = document.getElementById('test-feedback');
    
    progress.innerText = `${currentIndex + 1} / 10`;
    input.value = '';
    feedback.innerText = '';
    
    qDiv.innerText = currentMode === 'meaning' ? w.Word : w.Meaning;
    input.focus();
}

// 7. ì •ë‹µ ì²´í¬ (Enter ì…ë ¥ ì‹œ)
document.getElementById('test-input').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        const userAns = this.value.trim();
        const w = currentListWords[currentIndex];
        const feedback = document.getElementById('test-feedback');
        const correctAns = currentMode === 'meaning' ? w.Meaning : w.Word;
        
        let isCorrect = (userAns === correctAns);
        
        // ê²°ê³¼ ê¸°ë¡
        testResults.push({
            word: w.Word,
            meaning: w.Meaning,
            isCorrect: isCorrect,
            userAns: userAns || "(ë¯¸ì…ë ¥)",
            correctAns: correctAns
        });

        if (isCorrect) {
            score++;
            feedback.innerText = "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘";
            feedback.style.color = "var(--success)";
        } else {
            feedback.innerText = `ì˜¤ë‹µì…ë‹ˆë‹¤. ì •ë‹µ: ${correctAns}`;
            feedback.style.color = "var(--error)";
        }
        
        setTimeout(() => {
            currentIndex++;
            nextQuestion();
        }, 1200);
    }
});

// 8. ìµœì¢… ì„±ì í‘œ í™”ë©´ ìƒì„±
function showResult() {
    switchScreen('screen-result');
    document.getElementById('report-score').innerText = `${score * 10}ì `;
    document.getElementById('report-date').innerText = new Date().toLocaleString();
    document.getElementById('report-level').innerText = `ë ˆë²¨ 1 - ${currentMode === 'meaning' ? 'ëœ» í…ŒìŠ¤íŠ¸' : 'ì² ì í…ŒìŠ¤íŠ¸'}`;

    const listDiv = document.getElementById('report-detail-list');
    listDiv.innerHTML = ''; // ì´ˆê¸°í™”

    testResults.forEach((res, idx) => {
        const item = document.createElement('div');
        item.className = 'report-item';
        const ox = res.isCorrect ? '<span class="ox-o">O</span>' : '<span class="ox-x">X</span>';
        const correctInfo = res.isCorrect ? '' : `<span class="correct-ans">ì •ë‹µ: ${res.correctAns}</span>`;
        
        item.innerHTML = `
            <span>${idx + 1}. ${res.word}</span>
            <span>${res.userAns} ${ox} ${correctInfo}</span>
        `;
        listDiv.appendChild(item);
    });
}

// 9. ì„±ì í‘œ ì´ë¯¸ì§€ ì €ì¥ (PNG)
function saveAsImage() {
    const report = document.getElementById('report-card');
    html2canvas(report, { scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = `ì„±ì í‘œ_${Date.now()}.png`;
        link.href = canvas.toDataURL("image/png");
        link.click();
    });
}

function switchScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

function showList() {
    switchScreen('screen-list');
}
</script>
</body>
</html>